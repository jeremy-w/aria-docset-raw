<!doctype html><html lang="en-US" prefix="og: https://ogp.me/ns#">
<!-- Mirrored from developer.mozilla.org/en-US/docs/Web/Accessibility/Architecture by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2023 18:24:28 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="icon" href="../../../../favicon-48x48.cbbd161b.png"/><link rel="apple-touch-icon" href="../../../../apple-touch-icon.6803c6f0.png"/><meta name="theme-color" content="#ffffff"/><link rel="manifest" href="../../../../manifest.56b1cedc.json"/><link rel="search" type="application/opensearchdescription+xml" href="../../../../opensearch.xml" title="MDN Web Docs"/><title>Architecture - Accessibility | MDN</title><meta name="robots" content="index, follow"><meta name="description" content="The implementation of text and embedded objects in Mozilla is clever but confusing. Here is a bit of history and an explanation."/><meta property="og:url" content="Architecture.html"/><meta property="og:title" content="Architecture - Accessibility | MDN"/><meta property="og:locale" content="en-US"/><meta property="og:description" content="The implementation of text and embedded objects in Mozilla is clever but confusing. Here is a bit of history and an explanation."/><meta property="og:image" content="../../../../mdn-social-share.cd6c4a5a.png"/><meta property="twitter:card" content="summary_large_image"/><link rel="canonical" href="Architecture.html"/><style media="print">.article-actions-container,.document-toc-container,.language-menu,.main-menu-toggle,.mdn-cta-container,.on-github,.page-footer,.sidebar,.top-navigation-main,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><script src="../../../../static/js/ga.js" defer=""></script><script defer="defer" src="../../../../static/js/main.13dc67eb.js"></script><link href="../../../../static/css/main.4f6fc960.css" rel="stylesheet"></head><body><script>document.body.addEventListener("load",(t=>{t.target.classList.contains("interactive")&&t.target.setAttribute("data-readystate","complete")}),{capture:!0});const c={light:"#ffffff",dark:"#1b1b1b"};if(window&&document.documentElement)try{const t=window.localStorage.getItem("theme");t&&(document.documentElement.className=t,document.documentElement.style.backgroundColor=c[t])}catch(t){console.warn("Unable to read theme from localStorage",t)}</script><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#top-nav-search-input">Skip to search</a></li><li><a id="skip-select-language" href="#languages-switcher-button">Skip to select language</a></li></ul><div class="page-wrapper  category-web document-page"><div class="main-document-header-container"><header class="main-document-header-container top-navigation 
      
      "><div class="container "><div class="top-navigation-wrap"><a href="https://developer.mozilla.org/en-US/" class="logo" aria-label="MDN homepage"><svg id="mdn-docs-logo" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 694.9 104.4" style="enable-background:new 0 0 694.9 104.4" xml:space="preserve" role="img"><title>MDN Web Docs</title><style>.logo-m{fill:var(--text-link)}</style><g class="logo-m"><path d="M40.3 0 11.7 92.1H0L28.5 0h11.8zM50.7 0v92.1H40.3V0h10.4zM91 0 62.5 92.1H50.8L79.3 0H91zM101.4 0v92.1H91V0h10.4z"></path></g><path class="logo-m" d="M627.9 95.6h67v8.8h-67v-8.8z"></path><g style="fill:var(--text-primary)"><path d="M367 42h-4l-10.7 30.8h-5.5l-10.8-26h-.4l-10.5 26h-5.2L308.7 42h-3.8v-5.6H323V42h-6.5l6.8 20.4h.4l10.3-26h4.7l11.2 26h.5l5.7-20.3h-6.2v-5.6H367V42zM401.9 62c-.4 3.2-2 5.9-4.7 8.2-2.8 2.3-6.5 3.4-11.3 3.4-5.4 0-9.7-1.6-13.1-4.7-3.3-3.2-5-7.7-5-13.7 0-5.7 1.6-10.3 4.7-14s7.4-5.5 12.9-5.5c5.1 0 9.1 1.6 11.9 4.7s4.3 6.9 4.3 11.3c0 1.5-.2 3-.5 4.7h-25.6c.3 7.7 4 11.6 10.9 11.6 2.9 0 5.1-.7 6.5-2 1.5-1.4 2.5-3 3-4.9l6 .9zM394 51.3c.2-2.4-.4-4.7-1.8-6.9s-3.8-3.3-7-3.3c-3.1 0-5.3 1-6.9 3-1.5 2-2.5 4.4-2.8 7.2H394zM445 53.7c0 5-1.3 9.5-4 13.7s-6.9 6.2-12.7 6.2c-6 0-10.3-2.2-12.7-6.7-.1.4-.2 1.4-.4 2.9s-.3 2.5-.4 2.9h-7.3c.3-1.7.6-3.5.8-5.3.3-1.8.4-3.7.4-5.5V22.3h-6v-5.6H416v27c1.1-2.2 2.7-4.1 4.7-5.7 2-1.6 4.8-2.4 8.4-2.4 4.6 0 8.4 1.6 11.4 4.7 3 3.2 4.5 7.6 4.5 13.4zm-7.7.6c0-4.2-1-7.4-3-9.5-2-2.2-4.4-3.3-7.4-3.3-3.4 0-6 1.2-8 3.7-1.9 2.4-2.9 5-3 7.7V57c0 3 1 5.6 3 7.7s4.5 3.1 7.6 3.1c3.6 0 6.3-1.3 8.1-3.9 1.8-2.7 2.7-5.9 2.7-9.6zM506.5 72.8h-13.2v-7.2c-1.2 2.2-2.8 4.1-4.9 5.6-2.1 1.6-4.8 2.4-8.3 2.4-4.8 0-8.7-1.6-11.6-4.9-2.9-3.2-4.3-7.7-4.3-13.3 0-5 1.3-9.6 4-13.7 2.6-4.1 6.9-6.2 12.8-6.2 5.7 0 9.8 2.2 12.3 6.5V22.3h-8.6v-5.6h15.8v50.6h6v5.5zM493.2 56v-4.4c-.1-3-1.2-5.5-3.2-7.3s-4.4-2.8-7.2-2.8c-3.6 0-6.3 1.3-8.2 3.9-1.9 2.6-2.8 5.8-2.8 9.6 0 4.1 1 7.3 3 9.5s4.5 3.3 7.4 3.3c3.2 0 5.8-1.3 7.8-3.8 2.1-2.6 3.1-5.3 3.2-8zM546.3 54.6c0 5.6-1.8 10.2-5.3 13.7s-8.2 5.3-13.9 5.3-10.1-1.7-13.4-5.1c-3.3-3.4-5-7.9-5-13.5 0-5.3 1.6-9.9 4.7-13.7 3.2-3.8 7.9-5.7 14.2-5.7s11 1.9 14.1 5.7c3 3.7 4.6 8.1 4.6 13.3zm-7.7-.2c0-4-1-7.2-3-9.5s-4.8-3.5-8.2-3.5c-3.6 0-6.4 1.2-8.3 3.7s-2.9 5.6-2.9 9.5c0 3.7.9 6.8 2.8 9.4 1.9 2.6 4.6 3.9 8.3 3.9 3.6 0 6.4-1.3 8.4-3.8 1.9-2.6 2.9-5.8 2.9-9.7zM583.6 60.2c-.4 3.2-1.9 6.3-4.4 9.1-2.5 2.9-6.4 4.3-11.8 4.3-5.2 0-9.4-1.6-12.6-4.8-3.2-3.2-4.8-7.7-4.8-13.7 0-5.5 1.6-10.1 4.7-13.9 3.2-3.8 7.6-5.7 13.2-5.7 2.3 0 4.6.3 6.7.8 2.2.5 4.2 1.5 6.2 2.9l1.5 9.5-5.9.7-1.3-6.1c-2.1-1.2-4.5-1.8-7.2-1.8-3.5 0-6.1 1.2-7.7 3.7-1.7 2.5-2.5 5.7-2.5 9.6 0 4.1.9 7.3 2.7 9.5 1.8 2.3 4.4 3.4 7.8 3.4 5.2 0 8.2-2.9 9.2-8.8l6.2 1.3zM618.3 62.1c0 3.6-1.5 6.5-4.6 8.5s-7 3-11.7 3c-5.7 0-10.6-1.2-14.6-3.6l1.2-8.8 5.7.6-.2 4.7c1.1.5 2.3.9 3.6 1.1s2.6.3 3.9.3c2.4 0 4.5-.4 6.5-1.3 1.9-.9 2.9-2.2 2.9-4.1 0-1.8-.8-3.1-2.3-3.8s-3.5-1.3-5.8-1.7-4.6-.9-6.9-1.4c-2.3-.6-4.2-1.6-5.7-2.9-1.6-1.4-2.3-3.5-2.3-6.3 0-4.1 1.5-6.9 4.6-8.5s6.4-2.4 9.9-2.4c2.6 0 5 .3 7.2.9 2.2.6 4.3 1.4 6.1 2.4l.8 8.8-5.8.7-.8-5.7c-2.3-1-4.7-1.6-7.2-1.6-2.1 0-3.7.4-5.1 1.1-1.3.8-2 2-2 3.8 0 1.7.8 2.9 2.3 3.6 1.5.7 3.4 1.2 5.7 1.6 2.2.4 4.5.8 6.7 1.4 2.2.6 4.1 1.6 5.7 3 1.4 1.6 2.2 3.7 2.2 6.6zM197.6 73.2h-17.1v-5.5h3.8V51.9c0-3.7-.7-6.3-2.1-7.9-1.4-1.6-3.3-2.3-5.7-2.3-3.2 0-5.6 1.1-7.2 3.4s-2.4 4.6-2.5 6.9v15.6h6v5.5h-17.1v-5.5h3.8V51.9c0-3.8-.7-6.4-2.1-7.9-1.4-1.5-3.3-2.3-5.6-2.3-3.2 0-5.5 1.1-7.2 3.3-1.6 2.2-2.4 4.5-2.5 6.9v15.8h6.9v5.5h-20.2v-5.5h6V42.4h-6.1v-5.6h13.4v6.4c1.2-2.1 2.7-3.8 4.7-5.2 2-1.3 4.4-2 7.3-2s5.3.7 7.5 2.1c2.2 1.4 3.7 3.5 4.5 6.4 1.1-2.5 2.7-4.5 4.9-6.1s4.8-2.4 7.9-2.4c3.5 0 6.5 1.1 8.9 3.3s3.7 5.6 3.7 10.2v18.2h6.1v5.5zm42.5 0h-13.2V66c-1.2 2.2-2.8 4.1-4.9 5.6-2.1 1.6-4.8 2.4-8.3 2.4-4.8 0-8.7-1.6-11.6-4.9-2.9-3.2-4.3-7.7-4.3-13.3 0-5 1.3-9.6 4-13.7 2.6-4.1 6.9-6.2 12.8-6.2s9.8 2.2 12.3 6.5V22.7h-8.6v-5.6h15.8v50.6h6v5.5zm-13.3-16.8V52c-.1-3-1.2-5.5-3.2-7.3s-4.4-2.8-7.2-2.8c-3.6 0-6.3 1.3-8.2 3.9-1.9 2.6-2.8 5.8-2.8 9.6 0 4.1 1 7.3 3 9.5s4.5 3.3 7.4 3.3c3.2 0 5.8-1.3 7.8-3.8 2.1-2.6 3.1-5.3 3.2-8zm61.5 16.8H269v-5.5h6V51.9c0-3.7-.7-6.3-2.2-7.9-1.4-1.6-3.4-2.3-5.7-2.3-3.1 0-5.6 1-7.4 3s-2.8 4.4-2.9 7v15.9h6v5.5h-19.3v-5.5h6V42.4h-6.2v-5.6h13.6V43c2.6-4.6 6.8-6.9 12.7-6.9 3.6 0 6.7 1.1 9.2 3.3s3.7 5.6 3.7 10.2v18.2h6v5.4h-.2z"></path></g></svg></a><button title="Open main menu" type="button" class="button action has-icon main-menu-toggle" aria-haspopup="menu" aria-label="Open main menu" aria-expanded="false"><span class="button-wrap"><span class="icon icon-menu "></span><span class="visually-hidden">Open main menu</span></span></button></div><div class="top-navigation-main"><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container"><button type="button" id="references-button" class="top-level-entry menu-toggle" aria-controls="references-menu" aria-expanded="false">References</button><a href="https://developer.mozilla.org/en-US/docs/Web" class="top-level-entry">References</a><ul id="references-menu" class="submenu references hidden inline-submenu-lg" aria-labelledby="references-button"><li class="apis-link-container mobile-only "><a href="https://developer.mozilla.org/en-US/docs/Web" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview / Web Technology</div><p class="submenu-item-description">Web technology reference for developers</p></div></a></li><li class="html-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/HTML" class="submenu-item "><div class="submenu-icon html"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTML</div><p class="submenu-item-description">Structure of content on the web</p></div></a></li><li class="css-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/CSS" class="submenu-item "><div class="submenu-icon css"></div><div class="submenu-content-container"><div class="submenu-item-heading">CSS</div><p class="submenu-item-description">Code used to describe document style</p></div></a></li><li class="javascript-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" class="submenu-item "><div class="submenu-icon javascript"></div><div class="submenu-content-container"><div class="submenu-item-heading">JavaScript</div><p class="submenu-item-description">General-purpose scripting language</p></div></a></li><li class="http-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP" class="submenu-item "><div class="submenu-icon http"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTTP</div><p class="submenu-item-description">Protocol for transmitting web resources</p></div></a></li><li class="apis-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/API" class="submenu-item "><div class="submenu-icon apis"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web APIs</div><p class="submenu-item-description">Interfaces for building web applications</p></div></a></li><li class="apis-link-container "><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web Extensions</div><p class="submenu-item-description">Developing extensions for web browsers</p></div></a></li><li class="apis-link-container desktop-only "><a href="https://developer.mozilla.org/en-US/docs/Web" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web Technology</div><p class="submenu-item-description">Web technology reference for developers</p></div></a></li></ul></li><li class="top-level-entry-container"><button type="button" id="guides-button" class="top-level-entry menu-toggle" aria-controls="guides-menu" aria-expanded="false">Guides</button><a href="https://developer.mozilla.org/en-US/docs/Learn" class="top-level-entry">Guides</a><ul id="guides-menu" class="submenu guides hidden inline-submenu-lg" aria-labelledby="guides-button"><li class="apis-link-container mobile-only "><a href="https://developer.mozilla.org/en-US/docs/Learn" class="submenu-item "><div class="submenu-icon learn"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview / MDN Learning Area</div><p class="submenu-item-description">Learn web development</p></div></a></li><li class="apis-link-container desktop-only "><a href="https://developer.mozilla.org/en-US/docs/Learn" class="submenu-item "><div class="submenu-icon learn"></div><div class="submenu-content-container"><div class="submenu-item-heading">MDN Learning Area</div><p class="submenu-item-description">Learn web development</p></div></a></li><li class="html-link-container "><a href="https://developer.mozilla.org/en-US/docs/Learn/HTML" class="submenu-item "><div class="submenu-icon html"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTML</div><p class="submenu-item-description">Learn to structure web content with HTML</p></div></a></li><li class="css-link-container "><a href="https://developer.mozilla.org/en-US/docs/Learn/CSS" class="submenu-item "><div class="submenu-icon css"></div><div class="submenu-content-container"><div class="submenu-item-heading">CSS</div><p class="submenu-item-description">Learn to style content using CSS</p></div></a></li><li class="javascript-link-container "><a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript" class="submenu-item "><div class="submenu-icon javascript"></div><div class="submenu-content-container"><div class="submenu-item-heading">JavaScript</div><p class="submenu-item-description">Learn to run scripts in the browser</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Accessibility</div><p class="submenu-item-description">Learn to make the web accessible to all</p></div></a></li></ul></li><li class="top-level-entry-container"><button type="button" id="mdn-plus-button" class="top-level-entry menu-toggle" aria-controls="mdn-plus-menu" aria-expanded="false">MDN Plus</button><a href="https://developer.mozilla.org/en-US/plus" class="top-level-entry">MDN Plus</a><ul id="mdn-plus-menu" class="submenu mdn-plus hidden inline-submenu-lg" aria-labelledby="mdn-plus-button"><li class=" "><a href="https://developer.mozilla.org/en-US/plus" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview</div><p class="submenu-item-description">A customized MDN experience</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/plus/updates" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Updates</div><p class="submenu-item-description">All browser compatibility updates at a glance</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/plus/docs/features/overview" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Documentation</div><p class="submenu-item-description">Learn how to use MDN Plus</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/plus/docs/faq" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">FAQ</div><p class="submenu-item-description">Frequently asked questions about MDN Plus</p></div></a></li></ul></li></ul></nav><div class="header-search"><form action="https://developer.mozilla.org/en-US/search" class="search-form search-widget" id="top-nav-search-form" role="search"><label id="top-nav-search-label" for="top-nav-search-input" class="visually-hidden">Search MDN</label><input aria-activedescendant="" aria-autocomplete="list" aria-controls="top-nav-search-menu" aria-expanded="false" aria-labelledby="top-nav-search-label" autoComplete="off" id="top-nav-search-input" role="combobox" type="search" class="search-input-field" name="q" placeholder="   " required="" value=""/><button type="button" class="button action has-icon clear-search-button"><span class="button-wrap"><span class="icon icon-cancel "></span><span class="visually-hidden">Clear search input</span></span></button><button type="submit" class="button action has-icon search-button"><span class="button-wrap"><span class="icon icon-search "></span><span class="visually-hidden">Search</span></span></button><div id="top-nav-search-menu" role="listbox" aria-labelledby="top-nav-search-label"></div></form></div><div class="theme-switcher-menu"><button type="button" class="button action has-icon theme-switcher-menu small" aria-haspopup="menu"><span class="button-wrap"><span class="icon icon-theme-os-default "></span>Theme</span></button></div><ul class="auth-container"><li><a href="https://developer.mozilla.org/users/fxa/login/authenticate/?next=%2Fen-US%2Fdocs%2FWeb%2FAccessibility%2FArchitecture" class="signin-link" rel="nofollow">Log in</a></li><li><a class="button primary mdn-plus-subscribe-link" href="https://developer.mozilla.org/en-US/plus"><span class="button-wrap">Get MDN Plus</span></a></li></ul></div></div></header><div class="article-actions-container"><div class="container"><button type="button" class="button action has-icon sidebar-button" aria-label="Expand sidebar" aria-expanded="false" aria-controls="sidebar-quicklinks"><span class="button-wrap"><span class="icon icon-sidebar "></span></span></button><nav class="breadcrumbs-container" aria-label="Breadcrumb"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="https://developer.mozilla.org/en-US/docs/Web"><span property="name">References</span></a><meta property="position" content="1"/></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="https://developer.mozilla.org/en-US/docs/Web/Accessibility"><span property="name">Accessibility</span></a><meta property="position" content="2"/></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="Architecture.html"><span property="name">Architecture</span></a><meta property="position" content="3"/></li></ol></nav></div></div></div><div class="main-wrapper"><aside id="sidebar-quicklinks" class="sidebar"><button type="button" class="button action backdrop" aria-label="Collapse sidebar"><span class="button-wrap"></span></button><nav aria-label="Related Topics" class="sidebar-inner"><div class="in-nav-toc"><div class="document-toc-container"><section class="document-toc"><header><h2 class="document-toc-heading">In this article</h2></header><ul class="document-toc-list"><li class="document-toc-item "><a class="document-toc-link" href="#node_types">Node types</a></li><li class="document-toc-item "><a class="document-toc-link" href="#why_hyperlink_is_often_not_a_link">Why HyperLink is often not a link</a></li><li class="document-toc-item "><a class="document-toc-link" href="#api_comparison">API comparison</a></li><li class="document-toc-item "><a class="document-toc-link" href="#example">Example</a></li><li class="document-toc-item "><a class="document-toc-link" href="#implementation_classes">Implementation classes</a></li><li class="document-toc-item "><a class="document-toc-link" href="#how_does_an_at_deal_with_text">How does an AT deal with text</a></li><li class="document-toc-item "><a class="document-toc-link" href="#more_information">More information</a></li></ul></section></div></div><div><ol><li><a href="Accessibility_and_Spacial_Patterns.html">Accessibility and Spacial Patterns</a></li><li><a href="FAQ.html">Accessibility FAQ</a></li><li><a href="Information_for_Web_authors.html">Accessibility information for web authors</a></li><li><a href="Accessibility__What_users_can_to_to_browse_safely.html">Accessibility: What users can do to browse more safely</a></li><li><a href="Accessible_dynamic_content.html">Accessible dynamic content</a></li><li><a href="An_overview_of_accessible_web_applications_and_widgets.html">An overview of accessible web applications and widgets</a></li><li><em><a href="Architecture.html" aria-current="page">Architecture</a></em></li><li><a href="ARIA.html">ARIA</a></li><li><a href="Cognitive_accessibility.html">Cognitive accessibility</a></li><li><a href="Community.html">Community</a></li><li><a href="Keyboard-navigable_JavaScript_widgets.html">Keyboard-navigable JavaScript widgets</a></li><li><a href="Mobile_accessibility_checklist.html">Mobile accessibility checklist</a></li><li><a href="Understanding_WCAG.html">Understanding the Web Content Accessibility Guidelines</a></li><li><a href="Seizure_disorders.html">Web accessibility for seizures and physical reactions</a></li><li><a href="Understanding_Colors_and_Luminance.html">Web Accessibility: Understanding Colors and Luminance</a></li></ol></div></nav></aside><aside class="toc"><nav><div class="document-toc-container"><section class="document-toc"><header><h2 class="document-toc-heading">In this article</h2></header><ul class="document-toc-list"><li class="document-toc-item "><a class="document-toc-link" href="#node_types">Node types</a></li><li class="document-toc-item "><a class="document-toc-link" href="#why_hyperlink_is_often_not_a_link">Why HyperLink is often not a link</a></li><li class="document-toc-item "><a class="document-toc-link" href="#api_comparison">API comparison</a></li><li class="document-toc-item "><a class="document-toc-link" href="#example">Example</a></li><li class="document-toc-item "><a class="document-toc-link" href="#implementation_classes">Implementation classes</a></li><li class="document-toc-item "><a class="document-toc-link" href="#how_does_an_at_deal_with_text">How does an AT deal with text</a></li><li class="document-toc-item "><a class="document-toc-link" href="#more_information">More information</a></li></ul></section></div></nav></aside><main id="content" class="main-content  "><article class="main-page-content" lang="en-US"><h1>Architecture</h1><div class="section-content"><p>The implementation of text and embedded objects in Mozilla is clever but confusing. Here is a bit of history and an explanation.</p>
<p>Mozilla exposes a document containment hierarchy with text and embedded objects. Sometimes the embedded object is really just another text container with more embedded objects.</p>
<p>However in accessibility hierarchies such as ATK and IAccessible2, text is not exposed in leaf nodes as it is in a W3C DOM. The text is actually exposed via a special text interface in the parent of the text nodes. It is concatenated together with all its sibling text nodes, and embedded objects between the text nodes are exposed as the unicode embedded object character <code>\xfffc</code>. One reason for this is that there are fewer nodes to pass across process, and that improves performance.</p></div><section aria-labelledby="node_types"><h2 id="node_types"><a href="#node_types">Node types</a></h2><div class="section-content"><ul>
  <li>Text content (ROLE_TEXT) objects are implemented by nsTextAccessible. Their text is actually exposed in their parent <code>nsHyperTextAccessible</code> via nsIAccessibleText. When the hierarchy is finally exposed to ATK they are stripped out. They are in the nsIAccessible hierarchy to make it easy for <code>nsHyperTextAccessible</code> to piece its final text representation together. They are kept in IAccessible2 for backward compatibility with MSAA clients that expect text in leaf nodes.</li>
  <li>
    HTML
    (ROLE_WHITESPACE) objects are implemented by <code>nsHTMLBRAccessible</code>. They end up getting exposed as <code>\n</code> in their parent <code>nsHyperTextAccessible</code>. When the hierarchy is finally exposed to ATK they are stripped out as leaf nodes, but the \n remains in the containing text. They are in the <code>nsIAccessible</code> hierarchy to make it easy for <code>nsHyperTextAccessible</code> to piece its text representation together.
  </li>
  <li>Everything else uses whatever <code>nsAccessible</code> derived implementation that's appropriate. If it has text siblings, then it gets exposed as the unicode char for an embedded object, which is <code>\xfffc</code> within the parent <code>nsHyperTextAccessible</code>. In addition, <code>nsIAccessibleHyperLink</code> is implemented on any non-text child inside a container that also has text. This allows AT's to find its position within that text, because the hyperlink interface exposes a start and end index. In fact, the end index will always be 1 larger than the start index, because the object is always represented by a single <code>\xfffc</code> character. If you want to know that something is really a link, check to see if it is ROLE_LINK.</li>
  <li>HTML containers are implemented by <code>nsHyperTextAccessible</code>. They support the <code>nsIAccessibleHyperText</code> is implemented on any container element that has both text and embedded objects for accessible children.</li>
</ul></div></section><section aria-labelledby="why_hyperlink_is_often_not_a_link"><h2 id="why_hyperlink_is_often_not_a_link"><a href="#why_hyperlink_is_often_not_a_link">Why HyperLink is often not a link</a></h2><div class="section-content"><p>As explained above, anything that is embedded in text implements the Hyperlink interface.</p>
<p>While it is odd to call non-link objects a link, this was a necessary compromise in the <a href="https://website-archive.mozilla.org/www.mozilla.org/access/access/unix/new-atk.html" class="external" target="_blank">newatk design</a> because it is necessary to know where objects exist within their containing text. Previously the hyper link interface was really only for links, but the design could not fully represent an HTML document hierarchy. Keeping the link name of the interface is unfortunate but necessary for backwards compatibility, without introducing superfluous interfaces.</p></div></section><section aria-labelledby="api_comparison"><h2 id="api_comparison"><a href="#api_comparison">API comparison</a></h2><div class="section-content"><ul>
  <li><code>nsIAccessible</code> (internal). When you have an <code>nsIAccessibleHyperText</code>, you can ask for its links, which is the subset of children from the <code>nsIAccessible</code> hierarchy that are not text or whitespace.</li>
  <li><code>ATK</code>: Same as <code>nsIAccessible</code>, except that text and whitespace leaf nodes are not exposed. The children of any Hypertext object are an exact match to the links it exposes. The implementation doesn't create AtkObjects for a whitespace or text leaf nsIAccessibles. See the <a href="http://mxr.mozilla.org/seamonkey/search?string=isembeddedobject&amp;find=atk&amp;findi=&amp;filter=&amp;tree=seamonkey" class="external" target="_blank">ATK uses of IsEmbeddedObject()</a> for more information on how we do this.</li>
  <li><code>IAccessible2</code>: Same as <code>nsIAccessible</code>. Text and whitespace leaf nodes are exposed, but are redundant with the information in the parent object's <code>nsIAccessibleText</code>. This is done for backward compatibility with older MSAA clients which didn't have access to a text interface. The children of a Hypertext object are a superset of the links it exposes. The new system makes it easier to show caret positions etc., which will be an improvement in IA2 over MSAA.</li>
</ul></div></section><section aria-labelledby="example"><h2 id="example"><a href="#example">Example</a></h2><div class="section-content"><p>Take the following HTML code:</p>
<div class="code-example"><pre class="brush: html notranslate"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  Hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.mozilla.org/access<span class="token punctuation">"</span></span>
    <span class="token punctuation">&gt;</span></span>My link<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image.gif<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>is cool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span>
  <span class="token punctuation">&gt;</span></span>Bye
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div>
<p>Both the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a"><code>&lt;a&gt;</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img"><code>&lt;img&gt;</code></a> are hyperlinks Also, both the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/div"><code>&lt;div&gt;</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a"><code>&lt;a&gt;</code></a> are hypertexts So the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a"><code>&lt;a&gt;</code></a> is both a hypertext and a hyperlink, because it contains text and is contained within text.</p>
<p>This means that we have an exact mirror to the dom, but text lives in the parents instead of in the leaves, which now don't really provide additional useful information. They are only provided under MSAA/IA2 for backward compatibility.</p></div></section><section aria-labelledby="implementation_classes"><h2 id="implementation_classes"><a href="#implementation_classes">Implementation classes</a></h2><div class="section-content"><p>Here are some notes on the classes we use:</p>
<p><a href="http://lxr.mozilla.org/seamonkey/find?string=nshypertextacc" class="external" target="_blank">nsHyperTextAccessible</a> is for any container that may wrap both text and embedded object:</p>
<ul>
  <li><code>nsIAccessibleText</code> is supported if there is potentially any text in the container</li>
  <li><code>nsIAccessibleHyperText</code> is supported if there is potentially text and embedded objects together in the container.</li>
  <li><code>nsIAccessibleEditableText</code> is supported if the area is potentially editable. If it's actually editable it will also provide <code>STATE_EDITABLE</code>.</li>
</ul>
<p><a href="http://lxr.mozilla.org/seamonkey/find?string=nsAccessible%5C." class="external" target="_blank"><code>nsAccessible</code></a> still represents any node in the tree. If the node is embedded in a parent that is an <code>nsIAccessibleHyperText</code>, the node will be exposed as an <code>nsIAccessibleHyperLink</code>. Consumers can use this interface to determine the position of the object in the parent's text.</p>
<p><a href="http://lxr.mozilla.org/seamonkey/find?string=nstextaccessible" class="external" target="_blank"><code>nsTextAccessible</code></a> serves 2 purposes</p>
<ul>
  <li>it is used by <code>nsHyperTextAccessible</code> to collect information about itself</li>
  <li>it is still exposed in MSAA for backward compatibility by old windows assistive technologies. Those AT's don't yet know about any <code>IAccessibleText</code> yet, and want to see the hierarchy how they always did — with text in leaf nodes.</li>
</ul></div></section><section aria-labelledby="how_does_an_at_deal_with_text"><h2 id="how_does_an_at_deal_with_text"><a href="#how_does_an_at_deal_with_text">How does an AT deal with text</a></h2><div class="section-content"></div></section><section aria-labelledby="a_to_get_the_embedded_object_for_an_embedded_object_char"><h3 id="a_to_get_the_embedded_object_for_an_embedded_object_char"><a href="#a_to_get_the_embedded_object_for_an_embedded_object_char">(A) To get the embedded object for an embedded object char</a></h3><div class="section-content"><ol>
  <li><code>linkIndex = IAHyperText::getLinkIndex(offset)</code></li>
  <li><code>IAHyperLink\*object = IAHyperText::getLink(linkIndex)</code></li>
  <li><code>IAccessible\* accessible = QI/QS(object)</code></li>
</ol></div></section><section aria-labelledby="b_to_get_the_offset_in_the_parent_text_for_a_given_embedded_object"><h3 id="b_to_get_the_offset_in_the_parent_text_for_a_given_embedded_object"><a href="#b_to_get_the_offset_in_the_parent_text_for_a_given_embedded_object">(B) To get the offset in the parent text for a given embedded object</a></h3><div class="section-content"><ol>
  <li><code>QI/QA</code> to <code>IAHyperLink</code></li>
  <li>If not successful, then it is not embedded in text, so it's position in parent should be determined just by <code>IA2::indexInParent</code>, which will return its child offset within the parent. Examples of objects not embedded in text are the child options in list boxes and combo boxes.</li>
  <li>otherwise, use <code>IAHyperLink::getStartIndex()</code> to find the index in parent. In Firefox, the results of getEndIndex will always be the startIndex + 1, because links are always just represented by a single embedded object character</li>
</ol></div></section><section aria-labelledby="c_to_get_the_next_char_from_a_given_offset_in_an_accessible_text"><h3 id="c_to_get_the_next_char_from_a_given_offset_in_an_accessible_text"><a href="#c_to_get_the_next_char_from_a_given_offset_in_an_accessible_text">(C) To get the next char from a given offset in an accessible text</a></h3><div class="section-content"><ol>
  <li>If current <code>char</code> is <code>0</code> (end of string), then we are on a hard line break: get next node (typical depth first search), and set the current offset = 0</li>
  <li><code>IAText::ch = getCharacterAtOffset(++offset);</code></li>
  <li>If <code>ch</code> == embedded object char (<code>0xfffc</code>) then get object for that offset (see A above), then set the current offset to -1, and go to step 2</li>
  <li>if <code>ch == 0</code> then we must determine whether we're on a hard line break:
    <ol>
      <li>If the current accessible's <code>IA2</code> role is <code>SECTION</code>, <code>HEADING</code> or `PARAGRAPH then we are on a hard line break, so stop</li>
      <li>get the offset in the parent text for this object (see B above), and then repeat step (C)2 above</li>
    </ol>
  </li>
  <li>done</li>
</ol></div></section><section aria-labelledby="d_to_get_the_next_word_or_line"><h3 id="d_to_get_the_next_word_or_line"><a href="#d_to_get_the_next_word_or_line">(D) To get the next word or line</a></h3><div class="section-content"><ol>
  <li>Look one character ahead.</li>
  <li>If the next character does not exist, proceed to the next accessible in depth first search order and recurse on the first character until a non-embed is found.</li>
  <li>If the current character falls within a text substring, locate the line ending of that substring or the next embed, whichever comes first:
    <ol>
      <li>Get the current line start and end offsets.</li>
      <li>Compute the item offset relative to the start of this line</li>
      <li>Search forward from the starting offset for an embed character</li>
      <li>If an embed character is found, continue processing with offset = index plus the line start index</li>
      <li>If an embed character is not found:
        <ol>
          <li>If the line ending is equal to one less than the length of all text in the accessible, proceed to the next accessible in dept first search order and recurse on the first character until a non-embed is found.</li>
          <li>Otherwise, continue processing with offset = the index at the end of the line.</li>
        </ol>
      </li>
      <li>If the character at the offset is an embed, proceed to its corresponding accessible and recurse on the first character until a non-embed is found.</li>
      <li>Otherwise, the offset marks the start of a new line.</li>
    </ol>
  </li>
</ol>
<p>Navigating to the next word follows a similar pattern. Navigating previous requires returning to the embed character in the parent accessible when the point of regard reaches the end of text in the corresponding child accessible for the embed.</p>
<p>See <a href="http://svn.gnome.org/viewcvs/lsr/trunk/src/Adapters/ATSPI/HypertextAdapter.py?view=markup" class="external" target="_blank">http://svn.gnome.org/viewcvs/lsr/tru...py?view=markup</a> for a BSD implementation.</p></div></section><section aria-labelledby="e_to_grab_a_subtree_of_content"><h3 id="e_to_grab_a_subtree_of_content"><a href="#e_to_grab_a_subtree_of_content">(E) To grab a subtree of content</a></h3><div class="section-content"><p>Although under Windows text content is still exposed in leaf nodes of <code>ROLE_TEXT</code>, it is no longer necessary to visit those nodes. Therefore for parent nodes that support the HyperText interface, it is more performant to grab the text from the AccessibleText interface and then only visit the link children. The HyperLink interface can be used to grab the children. Using this technique is about twice as fast as visiting all nodes in the tree, according to tests run by the developers of NVDA.</p></div></section><section aria-labelledby="f_to_get_the_line_of_text_at_the_caret"><h3 id="f_to_get_the_line_of_text_at_the_caret"><a href="#f_to_get_the_line_of_text_at_the_caret">(F) To get the line of text at the caret</a></h3><div class="section-content"><p>Many editors, including the Mozilla editor, have a strange issue with caret offsets. The caret can sometimes visually appear at the end of a line, but logically it is on the first character on the next line. You can test this in a given editor by pressing the End key on a line, to see whether the caret is shown past the End of the line. To doublecheck, hit the Delete key and see if it removes the first char of the next line.</p>
<p>Therefore, as the user arrows up and down, if you use the AccessibleText::caretOffset and retrieve the line with that offset, you may not get the line with the visual caret returned. You are getting the line starting with the logical caret offset, which may be the next line.</p>
<p>To get around this problem, Mozilla allows the magic value of <code>-2</code> to be passed into <code>AccessibleText/AccessibleHyperText</code> methods that take a character offset. This value of <code>-2</code> means, use the caret position. Not only can this save extra calls, but it will always return the visual line of text when used with the getText methods and line boundaries.</p>
<p>The following magic offsets are useful to define in your code:</p>
<ul>
  <li><code>#define CHAR_OFFSET_END_OF_LINE = -1</code></li>
  <li><code>#define CHAR_OFFSET_CARET = -2</code></li>
</ul></div></section><section aria-labelledby="more_information"><h2 id="more_information"><a href="#more_information">More information</a></h2><div class="section-content"><p>Many more details on the Mozilla document hierarchy are in the <a href="https://website-archive.mozilla.org/www.mozilla.org/access/access/unix/new-atk.html" class="external" target="_blank">original design document for newatk</a>. There are also details on the <a href="https://www-archive.mozilla.org/access/architecture" class="external" target="_blank">general implementation of Mozilla accessibility architecture</a>.</p></div></section><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a content problem with this page?</h3><ul><li><a href="https://github.com/mdn/content/edit/main/files/en-us/web/accessibility/architecture/index.md" title="This will take you to GitHub, where you&#x27;ll need to sign in first." target="_blank" rel="noopener noreferrer">Edit the page on GitHub</a>.</li><li><a href="https://github.com/mdn/content/issues/new?template=page-report.yml&amp;mdn-url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAccessibility%2FArchitecture&amp;metadata=%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EPage+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60en-us%2Fweb%2Faccessibility%2Farchitecture%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAccessibility%2FArchitecture%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fblob%2Fmain%2Ffiles%2Fen-us%2Fweb%2Faccessibility%2Farchitecture%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fcommit%2Fa12fb8f2612fbdc6635b68c1dcd3c2fce212c10c%0A*+Document+last+modified%3A+2023-02-23T10%3A50%3A32.000Z%0A%0A%3C%2Fdetails%3E" title="This will take you to GitHub to file a new issue." target="_blank" rel="noopener noreferrer">Report the content issue</a>.</li><li><a href="https://github.com/mdn/content/blob/main/files/en-us/web/accessibility/architecture/index.md?plain=1" title="Folder: en-us/web/accessibility/architecture (Opens in a new tab)" target="_blank" rel="noopener noreferrer">View the source on GitHub</a>.</li></ul>Want to get more involved?<!-- --> <a href="https://github.com/mdn/content/blob/main/CONTRIBUTING.md" title="This will take you to our contribution guidelines on GitHub." target="_blank" rel="noopener noreferrer">Learn how to contribute</a>.</div><p class="last-modified-date">This page was last modified on<!-- --> <time dateTime="2023-02-23T10:50:32.000Z">Feb 23, 2023</time> by<!-- --> <a href="Architecture/contributors.txt">MDN contributors</a>.</p></div></aside></article></main></div></div><footer id="nav-footer" class="page-footer"><div class="page-footer-grid"><div class="page-footer-logo-col"><a href="https://developer.mozilla.org/" class="mdn-footer-logo" aria-label="MDN homepage"><svg width="48" height="17" viewBox="0 0 48 17" fill="none" xmlns="http://www.w3.org/2000/svg"><title id="mdn-footer-logo-svg">MDN logo</title><path d="M20.04 16.512H15.504V10.416C15.504 9.488 15.344 8.824 15.024 8.424C14.72 8.024 14.264 7.824 13.656 7.824C12.92 7.824 12.384 8.064 12.048 8.544C11.728 9.024 11.568 9.64 11.568 10.392V14.184H13.008V16.512H8.472V10.416C8.472 9.488 8.312 8.824 7.992 8.424C7.688 8.024 7.232 7.824 6.624 7.824C5.872 7.824 5.336 8.064 5.016 8.544C4.696 9.024 4.536 9.64 4.536 10.392V14.184H6.6V16.512H0V14.184H1.44V8.04H0.024V5.688H4.536V7.32C5.224 6.088 6.32 5.472 7.824 5.472C8.608 5.472 9.328 5.664 9.984 6.048C10.64 6.432 11.096 7.016 11.352 7.8C11.992 6.248 13.168 5.472 14.88 5.472C15.856 5.472 16.72 5.776 17.472 6.384C18.224 6.992 18.6 7.936 18.6 9.216V14.184H20.04V16.512Z" fill="currentColor"></path><path d="M33.6714 16.512H29.1354V14.496C28.8314 15.12 28.3834 15.656 27.7914 16.104C27.1994 16.536 26.4154 16.752 25.4394 16.752C24.0154 16.752 22.8954 16.264 22.0794 15.288C21.2634 14.312 20.8554 12.984 20.8554 11.304C20.8554 9.688 21.2554 8.312 22.0554 7.176C22.8554 6.04 24.0634 5.472 25.6794 5.472C26.5594 5.472 27.2794 5.648 27.8394 6C28.3994 6.352 28.8314 6.8 29.1354 7.344V2.352H26.9754V0H32.2314V14.184H33.6714V16.512ZM29.1354 11.04V10.776C29.1354 9.88 28.8954 9.184 28.4154 8.688C27.9514 8.176 27.3674 7.92 26.6634 7.92C25.9754 7.92 25.3674 8.176 24.8394 8.688C24.3274 9.2 24.0714 10.008 24.0714 11.112C24.0714 12.152 24.3114 12.944 24.7914 13.488C25.2714 14.032 25.8394 14.304 26.4954 14.304C27.3114 14.304 27.9514 13.96 28.4154 13.272C28.8954 12.584 29.1354 11.84 29.1354 11.04Z" fill="currentColor"></path><path d="M47.9589 16.512H41.9829V14.184H43.4229V10.416C43.4229 9.488 43.2629 8.824 42.9429 8.424C42.6389 8.024 42.1829 7.824 41.5749 7.824C40.8389 7.824 40.2709 8.056 39.8709 8.52C39.4709 8.968 39.2629 9.56 39.2469 10.296V14.184H40.6869V16.512H34.7109V14.184H36.1509V8.04H34.5909V5.688H39.2469V7.344C39.9669 6.096 41.1269 5.472 42.7269 5.472C43.7509 5.472 44.6389 5.776 45.3909 6.384C46.1429 6.992 46.5189 7.936 46.5189 9.216V14.184H47.9589V16.512Z" fill="currentColor"></path></svg></a><p>Your blueprint for a better internet.</p><ul class="social-icons"><li><a class="icon icon-twitter" href="https://twitter.com/mozdevnet" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Twitter</span></a></li><li><a class="icon icon-github-mark-small" href="https://github.com/mdn/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on GitHub</span></a></li></ul></div><div class="page-footer-nav-col-1"><h2 class="footer-nav-heading">MDN</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a href="https://developer.mozilla.org/en-US/about">About</a></li><li class="footer-nav-item"><a href="https://hacks.mozilla.org/" target="_blank" rel="noopener noreferrer">Hacks Blog</a></li><li class="footer-nav-item"><a href="https://www.mozilla.org/en-US/careers/listings/?team=Marketing" target="_blank" rel="noopener noreferrer">Careers</a></li><li class="footer-nav-item"><a href="https://developer.mozilla.org/en-US/advertising/with_us">Advertise with us</a></li></ul></div><div class="page-footer-nav-col-2"><h2 class="footer-nav-heading">Support</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a class="footer-nav-link" href="https://support.mozilla.org/products/mdn-plus">Product help</a></li><li class="footer-nav-item"><a class="footer-nav-link" href="https://developer.mozilla.org/en-US/docs/MDN/Community/Issues">Report an issue</a></li></ul></div><div class="page-footer-nav-col-3"><h2 class="footer-nav-heading">Our communities</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a class="footer-nav-link" href="https://developer.mozilla.org/en-US/community">MDN Community</a></li><li class="footer-nav-item"><a class="footer-nav-link" href="https://discourse.mozilla.org/c/mdn/236" target="_blank" rel="noopener noreferrer">MDN Forum</a></li><li class="footer-nav-item"><a class="footer-nav-link" href="https://wiki.mozilla.org/Matrix" target="_blank" rel="noopener noreferrer">MDN Chat</a></li></ul></div><div class="page-footer-nav-col-4"><h2 class="footer-nav-heading">Developers</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a class="footer-nav-link" href="https://developer.mozilla.org/en-US/docs/Web">Web Technologies</a></li><li class="footer-nav-item"><a class="footer-nav-link" href="https://developer.mozilla.org/en-US/docs/Learn">Learn Web Development</a></li><li class="footer-nav-item"><a class="footer-nav-link" href="https://developer.mozilla.org/en-US/plus">MDN Plus</a></li></ul></div><div class="page-footer-moz"><a href="https://www.mozilla.org/" class="footer-moz-logo-link" target="_blank" rel="noopener noreferrer"><svg width="112" height="32" fill="none" xmlns="http://www.w3.org/2000/svg"><title id="mozilla-footer-logo-svg">Mozilla logo</title><path d="M41.753 14.218c-2.048 0-3.324 1.522-3.324 4.157 0 2.423 1.119 4.286 3.29 4.286 2.082 0 3.447-1.678 3.447-4.347 0-2.826-1.522-4.096-3.413-4.096Zm54.89 7.044c0 .901.437 1.618 1.645 1.618 1.427 0 2.949-1.024 3.044-3.352-.649-.095-1.365-.185-2.02-.185-1.426-.005-2.668.397-2.668 1.92Z" fill="currentColor"></path><path d="M0 0v32h111.908V0H0Zm32.56 25.426h-5.87v-7.884c0-2.423-.806-3.352-2.39-3.352-1.924 0-2.702 1.365-2.702 3.324v4.868h1.864v3.044h-5.864v-7.884c0-2.423-.806-3.352-2.39-3.352-1.924 0-2.702 1.365-2.702 3.324v4.868h2.669v3.044H6.642v-3.044h1.863v-7.918H6.642V11.42h5.864v2.11c.839-1.489 2.3-2.39 4.252-2.39 2.02 0 3.878.963 4.566 3.01.778-1.862 2.361-3.01 4.566-3.01 2.512 0 4.812 1.522 4.812 4.84v6.402h1.863v3.044h-.005Zm9.036.307c-4.314 0-7.296-2.635-7.296-7.106 0-4.096 2.484-7.481 7.514-7.481s7.481 3.38 7.481 7.29c0 4.472-3.228 7.297-7.699 7.297Zm22.578-.307H51.942l-.403-2.11 7.7-8.846h-4.376l-.621 2.17-2.888-.313.498-4.907h12.294l.313 2.11-7.767 8.852h4.533l.654-2.172 3.167.308-.872 4.908Zm7.99 0h-4.191v-5.03h4.19v5.03Zm0-8.976h-4.191v-5.03h4.19v5.03Zm2.618 8.976 6.054-21.358h3.945l-6.054 21.358h-3.945Zm8.136 0 6.048-21.358h3.945l-6.054 21.358h-3.939Zm21.486.307c-1.863 0-2.887-1.085-3.072-2.792-.805 1.427-2.232 2.792-4.498 2.792-2.02 0-4.314-1.085-4.314-4.006 0-3.447 3.323-4.253 6.518-4.253.778 0 1.584.034 2.3.124v-.465c0-1.427-.034-3.133-2.3-3.133-.84 0-1.488.061-2.143.402l-.453 1.578-3.195-.34.549-3.224c2.45-.996 3.692-1.27 5.992-1.27 3.01 0 5.556 1.55 5.556 4.75v6.083c0 .805.314 1.085.963 1.085.184 0 .375-.034.587-.095l.034 2.11a5.432 5.432 0 0 1-2.524.654Z" fill="currentColor"></path></svg></a><ul class="footer-moz-list"><li class="footer-moz-item"><a href="https://www.mozilla.org/privacy/websites/" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Website Privacy Notice</a></li><li class="footer-moz-item"><a href="https://www.mozilla.org/privacy/websites/#cookies" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Cookies</a></li><li class="footer-moz-item"><a href="https://www.mozilla.org/about/legal/terms/mozilla" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Legal</a></li><li class="footer-moz-item"><a href="https://www.mozilla.org/about/governance/policies/participation/" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Community Participation Guidelines</a></li></ul></div><div class="page-footer-legal"><p id="license" class="page-footer-legal-text">Visit<!-- --> <a href="https://www.mozilla.org/" target="_blank" rel="noopener noreferrer">Mozilla Corporation’s</a> <!-- -->not-for-profit parent, the<!-- --> <a target="_blank" rel="noopener noreferrer" href="https://foundation.mozilla.org/">Mozilla Foundation</a>.<br/>Portions of this content are ©1998–<!-- -->2023<!-- --> by individual mozilla.org contributors. Content available under<!-- --> <a href="https://developer.mozilla.org/en-US/docs/MDN/Writing_guidelines/Attrib_copyright_license">a Creative Commons license</a>.</p></div></div></footer></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Architecture","mdn_url":"/en-US/docs/Web/Accessibility/Architecture","locale":"en-US","native":"English (US)","sidebarHTML":"<ol><li><a href=\"/en-US/docs/Web/Accessibility/Accessibility_and_Spacial_Patterns\">Accessibility and Spacial Patterns</a></li><li><a href=\"/en-US/docs/Web/Accessibility/FAQ\">Accessibility FAQ</a></li><li><a href=\"/en-US/docs/Web/Accessibility/Information_for_Web_authors\">Accessibility information for web authors</a></li><li><a href=\"/en-US/docs/Web/Accessibility/Accessibility:_What_users_can_to_to_browse_safely\">Accessibility: What users can do to browse more safely</a></li><li><a href=\"/en-US/docs/Web/Accessibility/Accessible_dynamic_content\">Accessible dynamic content</a></li><li><a href=\"/en-US/docs/Web/Accessibility/An_overview_of_accessible_web_applications_and_widgets\">An overview of accessible web applications and widgets</a></li><li><em><a href=\"/en-US/docs/Web/Accessibility/Architecture\" aria-current=\"page\">Architecture</a></em></li><li><a href=\"/en-US/docs/Web/Accessibility/ARIA\">ARIA</a></li><li><a href=\"/en-US/docs/Web/Accessibility/Cognitive_accessibility\">Cognitive accessibility</a></li><li><a href=\"/en-US/docs/Web/Accessibility/Community\">Community</a></li><li><a href=\"/en-US/docs/Web/Accessibility/Keyboard-navigable_JavaScript_widgets\">Keyboard-navigable JavaScript widgets</a></li><li><a href=\"/en-US/docs/Web/Accessibility/Mobile_accessibility_checklist\">Mobile accessibility checklist</a></li><li><a href=\"/en-US/docs/Web/Accessibility/Understanding_WCAG\">Understanding the Web Content Accessibility Guidelines</a></li><li><a href=\"/en-US/docs/Web/Accessibility/Seizure_disorders\">Web accessibility for seizures and physical reactions</a></li><li><a href=\"/en-US/docs/Web/Accessibility/Understanding_Colors_and_Luminance\">Web Accessibility: Understanding Colors and Luminance</a></li></ol>","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>The implementation of text and embedded objects in Mozilla is clever but confusing. Here is a bit of history and an explanation.</p>\n<p>Mozilla exposes a document containment hierarchy with text and embedded objects. Sometimes the embedded object is really just another text container with more embedded objects.</p>\n<p>However in accessibility hierarchies such as ATK and IAccessible2, text is not exposed in leaf nodes as it is in a W3C DOM. The text is actually exposed via a special text interface in the parent of the text nodes. It is concatenated together with all its sibling text nodes, and embedded objects between the text nodes are exposed as the unicode embedded object character <code>\\xfffc</code>. One reason for this is that there are fewer nodes to pass across process, and that improves performance.</p>"}},{"type":"prose","value":{"id":"node_types","title":"Node types","isH3":false,"content":"<ul>\n  <li>Text content (ROLE_TEXT) objects are implemented by nsTextAccessible. Their text is actually exposed in their parent <code>nsHyperTextAccessible</code> via nsIAccessibleText. When the hierarchy is finally exposed to ATK they are stripped out. They are in the nsIAccessible hierarchy to make it easy for <code>nsHyperTextAccessible</code> to piece its final text representation together. They are kept in IAccessible2 for backward compatibility with MSAA clients that expect text in leaf nodes.</li>\n  <li>\n    HTML\n    (ROLE_WHITESPACE) objects are implemented by <code>nsHTMLBRAccessible</code>. They end up getting exposed as <code>\\n</code> in their parent <code>nsHyperTextAccessible</code>. When the hierarchy is finally exposed to ATK they are stripped out as leaf nodes, but the \\n remains in the containing text. They are in the <code>nsIAccessible</code> hierarchy to make it easy for <code>nsHyperTextAccessible</code> to piece its text representation together.\n  </li>\n  <li>Everything else uses whatever <code>nsAccessible</code> derived implementation that's appropriate. If it has text siblings, then it gets exposed as the unicode char for an embedded object, which is <code>\\xfffc</code> within the parent <code>nsHyperTextAccessible</code>. In addition, <code>nsIAccessibleHyperLink</code> is implemented on any non-text child inside a container that also has text. This allows AT's to find its position within that text, because the hyperlink interface exposes a start and end index. In fact, the end index will always be 1 larger than the start index, because the object is always represented by a single <code>\\xfffc</code> character. If you want to know that something is really a link, check to see if it is ROLE_LINK.</li>\n  <li>HTML containers are implemented by <code>nsHyperTextAccessible</code>. They support the <code>nsIAccessibleHyperText</code> is implemented on any container element that has both text and embedded objects for accessible children.</li>\n</ul>"}},{"type":"prose","value":{"id":"why_hyperlink_is_often_not_a_link","title":"Why HyperLink is often not a link","isH3":false,"content":"<p>As explained above, anything that is embedded in text implements the Hyperlink interface.</p>\n<p>While it is odd to call non-link objects a link, this was a necessary compromise in the <a href=\"https://website-archive.mozilla.org/www.mozilla.org/access/access/unix/new-atk.html\" class=\"external\" target=\"_blank\">newatk design</a> because it is necessary to know where objects exist within their containing text. Previously the hyper link interface was really only for links, but the design could not fully represent an HTML document hierarchy. Keeping the link name of the interface is unfortunate but necessary for backwards compatibility, without introducing superfluous interfaces.</p>"}},{"type":"prose","value":{"id":"api_comparison","title":"API comparison","isH3":false,"content":"<ul>\n  <li><code>nsIAccessible</code> (internal). When you have an <code>nsIAccessibleHyperText</code>, you can ask for its links, which is the subset of children from the <code>nsIAccessible</code> hierarchy that are not text or whitespace.</li>\n  <li><code>ATK</code>: Same as <code>nsIAccessible</code>, except that text and whitespace leaf nodes are not exposed. The children of any Hypertext object are an exact match to the links it exposes. The implementation doesn't create AtkObjects for a whitespace or text leaf nsIAccessibles. See the <a href=\"http://mxr.mozilla.org/seamonkey/search?string=isembeddedobject&amp;find=atk&amp;findi=&amp;filter=&amp;tree=seamonkey\" class=\"external\" target=\"_blank\">ATK uses of IsEmbeddedObject()</a> for more information on how we do this.</li>\n  <li><code>IAccessible2</code>: Same as <code>nsIAccessible</code>. Text and whitespace leaf nodes are exposed, but are redundant with the information in the parent object's <code>nsIAccessibleText</code>. This is done for backward compatibility with older MSAA clients which didn't have access to a text interface. The children of a Hypertext object are a superset of the links it exposes. The new system makes it easier to show caret positions etc., which will be an improvement in IA2 over MSAA.</li>\n</ul>"}},{"type":"prose","value":{"id":"example","title":"Example","isH3":false,"content":"<p>Take the following HTML code:</p>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  Hello<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.mozilla.org/access<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token punctuation\">&gt;</span></span>My link<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image.gif<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/&gt;</span></span>is cool<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span>\n  <span class=\"token punctuation\">&gt;</span></span>Bye\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<p>Both the <a href=\"/en-US/docs/Web/HTML/Element/a\"><code>&lt;a&gt;</code></a> and <a href=\"/en-US/docs/Web/HTML/Element/img\"><code>&lt;img&gt;</code></a> are hyperlinks Also, both the <a href=\"/en-US/docs/Web/HTML/Element/div\"><code>&lt;div&gt;</code></a> and <a href=\"/en-US/docs/Web/HTML/Element/a\"><code>&lt;a&gt;</code></a> are hypertexts So the <a href=\"/en-US/docs/Web/HTML/Element/a\"><code>&lt;a&gt;</code></a> is both a hypertext and a hyperlink, because it contains text and is contained within text.</p>\n<p>This means that we have an exact mirror to the dom, but text lives in the parents instead of in the leaves, which now don't really provide additional useful information. They are only provided under MSAA/IA2 for backward compatibility.</p>"}},{"type":"prose","value":{"id":"implementation_classes","title":"Implementation classes","isH3":false,"content":"<p>Here are some notes on the classes we use:</p>\n<p><a href=\"http://lxr.mozilla.org/seamonkey/find?string=nshypertextacc\" class=\"external\" target=\"_blank\">nsHyperTextAccessible</a> is for any container that may wrap both text and embedded object:</p>\n<ul>\n  <li><code>nsIAccessibleText</code> is supported if there is potentially any text in the container</li>\n  <li><code>nsIAccessibleHyperText</code> is supported if there is potentially text and embedded objects together in the container.</li>\n  <li><code>nsIAccessibleEditableText</code> is supported if the area is potentially editable. If it's actually editable it will also provide <code>STATE_EDITABLE</code>.</li>\n</ul>\n<p><a href=\"http://lxr.mozilla.org/seamonkey/find?string=nsAccessible%5C.\" class=\"external\" target=\"_blank\"><code>nsAccessible</code></a> still represents any node in the tree. If the node is embedded in a parent that is an <code>nsIAccessibleHyperText</code>, the node will be exposed as an <code>nsIAccessibleHyperLink</code>. Consumers can use this interface to determine the position of the object in the parent's text.</p>\n<p><a href=\"http://lxr.mozilla.org/seamonkey/find?string=nstextaccessible\" class=\"external\" target=\"_blank\"><code>nsTextAccessible</code></a> serves 2 purposes</p>\n<ul>\n  <li>it is used by <code>nsHyperTextAccessible</code> to collect information about itself</li>\n  <li>it is still exposed in MSAA for backward compatibility by old windows assistive technologies. Those AT's don't yet know about any <code>IAccessibleText</code> yet, and want to see the hierarchy how they always did — with text in leaf nodes.</li>\n</ul>"}},{"type":"prose","value":{"id":"how_does_an_at_deal_with_text","title":"How does an AT deal with text","isH3":false,"content":""}},{"type":"prose","value":{"id":"a_to_get_the_embedded_object_for_an_embedded_object_char","title":"(A) To get the embedded object for an embedded object char","isH3":true,"content":"<ol>\n  <li><code>linkIndex = IAHyperText::getLinkIndex(offset)</code></li>\n  <li><code>IAHyperLink\\*object = IAHyperText::getLink(linkIndex)</code></li>\n  <li><code>IAccessible\\* accessible = QI/QS(object)</code></li>\n</ol>"}},{"type":"prose","value":{"id":"b_to_get_the_offset_in_the_parent_text_for_a_given_embedded_object","title":"(B) To get the offset in the parent text for a given embedded object","isH3":true,"content":"<ol>\n  <li><code>QI/QA</code> to <code>IAHyperLink</code></li>\n  <li>If not successful, then it is not embedded in text, so it's position in parent should be determined just by <code>IA2::indexInParent</code>, which will return its child offset within the parent. Examples of objects not embedded in text are the child options in list boxes and combo boxes.</li>\n  <li>otherwise, use <code>IAHyperLink::getStartIndex()</code> to find the index in parent. In Firefox, the results of getEndIndex will always be the startIndex + 1, because links are always just represented by a single embedded object character</li>\n</ol>"}},{"type":"prose","value":{"id":"c_to_get_the_next_char_from_a_given_offset_in_an_accessible_text","title":"(C) To get the next char from a given offset in an accessible text","isH3":true,"content":"<ol>\n  <li>If current <code>char</code> is <code>0</code> (end of string), then we are on a hard line break: get next node (typical depth first search), and set the current offset = 0</li>\n  <li><code>IAText::ch = getCharacterAtOffset(++offset);</code></li>\n  <li>If <code>ch</code> == embedded object char (<code>0xfffc</code>) then get object for that offset (see A above), then set the current offset to -1, and go to step 2</li>\n  <li>if <code>ch == 0</code> then we must determine whether we're on a hard line break:\n    <ol>\n      <li>If the current accessible's <code>IA2</code> role is <code>SECTION</code>, <code>HEADING</code> or `PARAGRAPH then we are on a hard line break, so stop</li>\n      <li>get the offset in the parent text for this object (see B above), and then repeat step (C)2 above</li>\n    </ol>\n  </li>\n  <li>done</li>\n</ol>"}},{"type":"prose","value":{"id":"d_to_get_the_next_word_or_line","title":"(D) To get the next word or line","isH3":true,"content":"<ol>\n  <li>Look one character ahead.</li>\n  <li>If the next character does not exist, proceed to the next accessible in depth first search order and recurse on the first character until a non-embed is found.</li>\n  <li>If the current character falls within a text substring, locate the line ending of that substring or the next embed, whichever comes first:\n    <ol>\n      <li>Get the current line start and end offsets.</li>\n      <li>Compute the item offset relative to the start of this line</li>\n      <li>Search forward from the starting offset for an embed character</li>\n      <li>If an embed character is found, continue processing with offset = index plus the line start index</li>\n      <li>If an embed character is not found:\n        <ol>\n          <li>If the line ending is equal to one less than the length of all text in the accessible, proceed to the next accessible in dept first search order and recurse on the first character until a non-embed is found.</li>\n          <li>Otherwise, continue processing with offset = the index at the end of the line.</li>\n        </ol>\n      </li>\n      <li>If the character at the offset is an embed, proceed to its corresponding accessible and recurse on the first character until a non-embed is found.</li>\n      <li>Otherwise, the offset marks the start of a new line.</li>\n    </ol>\n  </li>\n</ol>\n<p>Navigating to the next word follows a similar pattern. Navigating previous requires returning to the embed character in the parent accessible when the point of regard reaches the end of text in the corresponding child accessible for the embed.</p>\n<p>See <a href=\"http://svn.gnome.org/viewcvs/lsr/trunk/src/Adapters/ATSPI/HypertextAdapter.py?view=markup\" class=\"external\" target=\"_blank\">http://svn.gnome.org/viewcvs/lsr/tru...py?view=markup</a> for a BSD implementation.</p>"}},{"type":"prose","value":{"id":"e_to_grab_a_subtree_of_content","title":"(E) To grab a subtree of content","isH3":true,"content":"<p>Although under Windows text content is still exposed in leaf nodes of <code>ROLE_TEXT</code>, it is no longer necessary to visit those nodes. Therefore for parent nodes that support the HyperText interface, it is more performant to grab the text from the AccessibleText interface and then only visit the link children. The HyperLink interface can be used to grab the children. Using this technique is about twice as fast as visiting all nodes in the tree, according to tests run by the developers of NVDA.</p>"}},{"type":"prose","value":{"id":"f_to_get_the_line_of_text_at_the_caret","title":"(F) To get the line of text at the caret","isH3":true,"content":"<p>Many editors, including the Mozilla editor, have a strange issue with caret offsets. The caret can sometimes visually appear at the end of a line, but logically it is on the first character on the next line. You can test this in a given editor by pressing the End key on a line, to see whether the caret is shown past the End of the line. To doublecheck, hit the Delete key and see if it removes the first char of the next line.</p>\n<p>Therefore, as the user arrows up and down, if you use the AccessibleText::caretOffset and retrieve the line with that offset, you may not get the line with the visual caret returned. You are getting the line starting with the logical caret offset, which may be the next line.</p>\n<p>To get around this problem, Mozilla allows the magic value of <code>-2</code> to be passed into <code>AccessibleText/AccessibleHyperText</code> methods that take a character offset. This value of <code>-2</code> means, use the caret position. Not only can this save extra calls, but it will always return the visual line of text when used with the getText methods and line boundaries.</p>\n<p>The following magic offsets are useful to define in your code:</p>\n<ul>\n  <li><code>#define CHAR_OFFSET_END_OF_LINE = -1</code></li>\n  <li><code>#define CHAR_OFFSET_CARET = -2</code></li>\n</ul>"}},{"type":"prose","value":{"id":"more_information","title":"More information","isH3":false,"content":"<p>Many more details on the Mozilla document hierarchy are in the <a href=\"https://website-archive.mozilla.org/www.mozilla.org/access/access/unix/new-atk.html\" class=\"external\" target=\"_blank\">original design document for newatk</a>. There are also details on the <a href=\"https://www-archive.mozilla.org/access/architecture\" class=\"external\" target=\"_blank\">general implementation of Mozilla accessibility architecture</a>.</p>"}}],"toc":[{"text":"Node types","id":"node_types"},{"text":"Why HyperLink is often not a link","id":"why_hyperlink_is_often_not_a_link"},{"text":"API comparison","id":"api_comparison"},{"text":"Example","id":"example"},{"text":"Implementation classes","id":"implementation_classes"},{"text":"How does an AT deal with text","id":"how_does_an_at_deal_with_text"},{"text":"More information","id":"more_information"}],"summary":"The implementation of text and embedded objects in Mozilla is clever but confusing. Here is a bit of history and an explanation.","popularity":0.0001,"modified":"2023-02-23T10:50:32.000Z","source":{"folder":"en-us/web/accessibility/architecture","github_url":"https://github.com/mdn/content/blob/main/files/en-us/web/accessibility/architecture/index.md","last_commit_url":"https://github.com/mdn/content/commit/a12fb8f2612fbdc6635b68c1dcd3c2fce212c10c","filename":"index.md"},"short_title":"Architecture","parents":[{"uri":"/en-US/docs/Web","title":"References"},{"uri":"/en-US/docs/Web/Accessibility","title":"Accessibility"},{"uri":"/en-US/docs/Web/Accessibility/Architecture","title":"Architecture"}],"pageTitle":"Architecture - Accessibility | MDN","noIndexing":false}}</script></body>
<!-- Mirrored from developer.mozilla.org/en-US/docs/Web/Accessibility/Architecture by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2023 18:24:28 GMT -->
</html>